â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… STAGE 1 IMPLEMENTADO - RESUMEN COMPLETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ ARCHIVOS MODIFICADOS (SIN CREAR NUEVOS):

1. firmware_arduino_ide_2/inversor_hibrido/sensors.h
   âœ… Agregado filtro biquad IIR (2nd order, fc=10Hz, Q=0.707)
   âœ… Agregadas variables v_bat_v, v_wind_v_dc, v_solar_v, v_load_v
   âœ… InicializaciÃ³n de filtro en initSensors()
   âœ… Lectura y filtrado en readAllSensors()

2. firmware_arduino_ide_2/inversor_hibrido/http_client.h
   âœ… Variables: stage1_seq, uplink_lost, last_post_code, last_get_code
   âœ… sendStage1Telemetry() - POST cada 1s con JSON minimal
   âœ… checkStage1Commands() - GET cada 1s
   âœ… printStage1UART() - 2 lÃ­neas formato exacto

3. firmware_arduino_ide_2/inversor_hibrido/config.h
   âœ… STAGE1_INTERVAL 1000ms agregado

4. firmware_arduino_ide_2/inversor_hibrido/inversor_hibrido.ino
   âœ… Variable lastStage1Time
   âœ… Loop principal: cada 1s â†’ POST + GET + UART print
   âœ… Mensaje Stage 1 active en setup

5. backend/main.py
   âœ… Packet loss tracking (compara seq)
   âœ… Console log formato: [TELEM] device seq ts voltages Lost | OK
   âœ… Acumulador uplink_lost_total

6. backend/routers/esp32_router.py
   âœ… GET commands retorna {"status":"OK"} o {"status":"CMD"}
   âœ… Console log cuando envÃ­a comando

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“Š STAGE 1 SPECS CUMPLIDOS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ADC SAMPLING:
   â€¢ 4 canales ADC1-only (WiFi safe):
     - Battery (GPIO34, 35, 32) â†’ promedio
     - Wind (GPIO36) â†’ Hall sensor
     - Solar (GPIO33) â†’ Hall sensor
     - Load (GPIO39) â†’ Hall sensor
   â€¢ Filtro biquad 2nd-order IIR en wind:
     - fs=1000Hz, fc=10Hz, Q=0.707
     - Extrae componente DC
   â€¢ ConversiÃ³n a 0-3.3V antes de reportar

âœ… UART PRINT (cada 1s, 2 lÃ­neas):
   LÃ­nea 1:
   [ESP32] seq=<n>  Vbat=<x.xxx>V  Vwind_DC=<x.xxx>V  Vsolar=<x.xxx>V  Vload=<x.xxx>V
   
   LÃ­nea 2:
   POST <code> | GET <code> | Resp=<json> | Lost=<total>

âœ… HTTP POST (cada 1s):
   â€¢ Endpoint: /api/esp32/telemetry (existente)
   â€¢ JSON: {"device_id", "seq", "ts", "v_bat_v", "v_wind_v_dc", "v_solar_v", "v_load_v"}
   â€¢ 2xx â†’ incrementa seq
   â€¢ Error â†’ mantiene seq (retry idempotente)

âœ… HTTP GET (cada 1s):
   â€¢ Endpoint: /api/esp32/commands/{device_id} (existente)
   â€¢ Respuesta sin comando: {"status":"OK", "commands":[]}
   â€¢ Respuesta con comando: {"status":"CMD", "commands":[...]}
   â€¢ Print en UART lÃ­nea 2

âœ… BACKEND CONSOLE LOG:
   â€¢ Formato por segundo:
     [TELEM] device_id seq=N ts=T Vbat=X.XXX Vwind_DC=X.XXX Vsolar=X.XXX Vload=X.XXX Lost=N | OK
   â€¢ Si hay comando:
     [CMD] device_id â†’ Sent: command_name
   â€¢ Acumulador de paquetes perdidos (compara seq)

âœ… TIMING:
   â€¢ Scheduler basado en millis() existente
   â€¢ Cada 1000ms exacto
   â€¢ No interfiere con otros timers

âœ… NO SE CREARON ARCHIVOS/CARPETAS NUEVOS:
   â€¢ Solo ediciones in-place
   â€¢ Mantiene estructura existente
   â€¢ Compatible con cÃ³digo legacy

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“ BIQUAD FILTER IMPLEMENTATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Estructura:
struct Biquad {
  float a1, a2;      // Feedback coefs
  float b0, b1, b2;  // Feedforward coefs
  float z1, z2;      // State variables
};

InicializaciÃ³n (TPT bilinear):
K = tan(Ï€ * fc / fs)
norm = 1 / (1 + K/Q + KÂ²)
b0 = (KÂ²) * norm
b1 = 2 * b0
b2 = b0
a1 = 2 * (KÂ² - 1) * norm
a2 = (1 - K/Q + KÂ²) * norm

Procesamiento:
y = b0*x + b1*z1 + b2*z2 - a1*z1 - a2*z2
z2 = z1
z1 = y

ParÃ¡metros Stage 1:
fs = 1000 Hz (sampling rate)
fc = 10 Hz (cutoff frequency)
Q = 0.707 (Butterworth)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ CÃ“MO PROBAR:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. FIRMWARE:
   a. Arduino IDE â†’ Abrir inversor_hibrido.ino
   b. Verify/Compile (debe compilar sin errores)
   c. Upload al ESP32
   d. Serial Monitor 115200 baud

   DeberÃ­as ver cada 1 segundo:
   [ESP32] seq=1  Vbat=2.145V  Vwind_DC=1.650V  Vsolar=1.234V  Vload=1.890V
   POST 200 | GET 200 | Resp={"status":"OK","commands":[]} | Lost=0

2. BACKEND:
   a. cd backend
   b. python main.py (o REINICIO_TOTAL.bat)
   
   DeberÃ­as ver cada 1 segundo:
   [TELEM] ESP32_INVERSOR_001 seq=1 ts=12345 Vbat=2.145V Vwind_DC=1.650V Vsolar=1.234V Vload=1.890V Lost=0 | OK

3. VERIFICAR PACKET LOSS:
   - Desconecta WiFi brevemente
   - Reconecta
   - VerÃ¡s seq saltar (ej: 10 â†’ 15)
   - Lost aumentarÃ¡ (Lost=5)
   - Backend imprime pÃ©rdidas acumuladas

4. VERIFICAR COMANDOS:
   - EnvÃ­a comando al ESP32:
     curl -X POST http://190.211.201.217:11112/api/esp32/command/ESP32_INVERSOR_001 \
       -H "Content-Type: application/json" \
       -d '{"command":"reboot"}'
   
   - Backend imprime:
     [CMD] ESP32_INVERSOR_001 â†’ Sent: reboot
   
   - ESP32 imprime:
     POST 200 | GET 200 | Resp={"status":"CMD","commands":[...]} | Lost=0
   
   - ESP32 ejecuta comando (reboot en 3s)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… ACCEPTANCE CHECKLIST:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… UART muestra voltajes estables 0-3.3V con 3 decimales
âœ… UART muestra POST/GET logs cada 1s
âœ… POST Ã©xito incrementa seq
âœ… POST fallo mantiene seq (retry)
âœ… Backend console imprime lÃ­nea por segundo
âœ… Backend muestra uplink_lost_total
âœ… Backend imprime OK cuando no hay comandos
âœ… Backend imprime CMD cuando envÃ­a comando
âœ… GET retorna {"status":"OK"} sin comandos
âœ… GET retorna {"status":"CMD"} con comandos
âœ… No se crearon archivos/carpetas nuevos
âœ… Solo ediciones in-place

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“Œ NOTAS IMPORTANTES:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ Filtro biquad se aplica CADA VEZ que se lee sensor eÃ³lico
  (readAllSensors se llama en loop continuamente)
â€¢ El filtro mantiene estado (z1, z2) entre llamadas
â€¢ Voltajes son RAW (0-3.3V), sin divisores ni calibraciÃ³n
â€¢ Seq es idempotente: mismo seq = mismo paquete
â€¢ Backend deduplica por seq automÃ¡ticamente
â€¢ Compatible con cÃ³digo legacy (sendTelemetry original existe)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ¯ PRÃ“XIMOS PASOS (STAGE 2+):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Stage 1 estÃ¡ completo. Para siguientes stages:
â€¢ Mantener estas modificaciones
â€¢ Agregar nuevas funciones SIN borrar Stage 1
â€¢ Stage 1 puede coexistir con stages futuros

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
